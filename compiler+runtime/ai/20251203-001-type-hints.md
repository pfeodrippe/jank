# Type Hints and Metadata in jank

## Summary

jank has a **metadata system** using the caret syntax (`^`), inherited from Clojure. This is not a static type system but rather runtime metadata annotations for documentation, optimization hints, and special behaviors.

## Does jank Have Type Hints?

**Traditional type hints (like Clojure's `^String`):** Not implemented as type annotations.

**Metadata system:** Yes, fully functional using `^keyword` or `^{:map}` syntax.

## Syntax

```clojure
; Keyword metadata - becomes {:keyword true}
^:dynamic *ns*
^:private internal-value
^:const default-port

; Map metadata
^{:arglists '([x] [x y])} my-fn
^{:doc "Description"} my-var

; Multiple metadata hints (merged)
^{:foo :bar} ^:meow ()  ; => {:foo :bar :meow true}
```

## Key Implementation Files

| Component | File | Description |
|-----------|------|-------------|
| Lexer | `src/cpp/jank/read/lex.cpp:1343` | Generates `meta_hint` token for `^` |
| Parser | `src/cpp/jank/read/parse.cpp:525` | `parse_meta_hint()` function |
| Expression | `include/cpp/jank/analyze/expr/function.hpp` | Stores metadata in function expr |
| Tests | `test/cpp/jank/read/parse.cpp:955-1050` | Comprehensive metadata tests |

## Common Metadata Keys

| Key | Purpose | Example |
|-----|---------|---------|
| `:dynamic` | Dynamic binding | `(def ^:dynamic *ns*)` |
| `:private` | Private definition | `(def ^:private internal)` |
| `:const` | Compile-time constant | `(def ^:const port 5555)` |
| `:macro` | Marks macros | Implicit on `defmacro` |
| `:export` | WASM export to JS | `(defn ^:export greet [])` |
| `:doc` | Documentation | `^{:doc "..."}` |
| `:arglists` | Function signatures | `^{:arglists '([x])}` |

## Performance Optimization Metadata

jank uses metadata for unboxing optimization hints:

```clojure
(defn
  ^{:arities {2 {:supports-unboxed-input? true
                 :unboxed-output? true}}}
  +
  ([x] x)
  ([l r] (cpp/jank.runtime.add l r)))
```

**Performance metadata keys:**
- `:supports-unboxed-input?` - Function accepts unboxed (primitive) inputs
- `:unboxed-output?` - Function returns unboxed output

Used in `clojure/core.jank` for arithmetic (`+`, `-`, `*`, `/`, `<`, `>`, etc.) and `jank/math.jank` for math functions (`sqrt`, `abs`, `sin`, `cos`, etc.).

## Metadatable Types

Only these types can have metadata attached:
- Symbols
- Keywords
- Lists
- Vectors
- Maps
- Sets
- Functions

**Non-metadatable (will error):**
- `nil`
- Numbers
- Booleans
- Strings

## Parser Behavior

1. Reads metadata value after `^`
2. Validates it's a keyword or map
3. Keywords become `{:keyword true}`
4. Reads target value
5. Verifies target is metadatable
6. Applies via `with_meta()` or merges existing

## Future Considerations

jank currently lacks Clojure-style type hints for performance (like `^long`, `^double`, `^String`). These could potentially:
- Enable primitive type declarations
- Help with interop type checking
- Guide JIT compilation

The infrastructure (metadata parsing) exists, but semantic type checking is not implemented.
